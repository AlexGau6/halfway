<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OpenLayers + OSRM Routing</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
  <style>
    #map { width: 100%; height: 500px; }
    #info { margin-top: 10px; font-family: Arial, sans-serif; }
  </style>
</head>
<body>
  <h2>Click Two Points to Get Driving Route</h2>
  <div id="map"></div>
  <div id="info">Distance: <span id="distance">0</span> km, Duration: <span id="duration">0</span> min</div>

  <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
  <script>
    const map = new ol.Map({
      target: 'map',
      layers: [new ol.layer.Tile({ source: new ol.source.OSM() })],
      view: new ol.View({
        center: ol.proj.fromLonLat([-72.2518, 41.8084]), // UConn
        zoom: 8
      })
    });

    const points = [];
    const vectorSource = new ol.source.Vector();
    const vectorLayer = new ol.layer.Vector({ source: vectorSource });
    map.addLayer(vectorLayer);

    map.on('click', function (event) {
      if (points.length >= 2) {
        points.length = 0;
        vectorSource.clear();
        document.getElementById('distance').textContent = '0';
        document.getElementById('duration').textContent = '0';
      }

      const coord = ol.proj.toLonLat(event.coordinate);
      points.push(coord);

      const feature = new ol.Feature({
        geometry: new ol.geom.Point(event.coordinate)
      });
      vectorSource.addFeature(feature);

      if (points.length === 2) {
        const url = `https://router.project-osrm.org/route/v1/driving/${points[0][0]},${points[0][1]};${points[1][0]},${points[1][1]}?overview=full&geometries=geojson`;

        fetch(url)
          .then(res => res.json())
          .then(data => {
            if (data.code === "Ok") {
              const route = data.routes[0];
              const line = new ol.geom.LineString(route.geometry.coordinates).transform('EPSG:4326', 'EPSG:3857');
              vectorSource.addFeature(new ol.Feature({ geometry: line }));

              const distanceKm = route.distance / 1000;
              const durationMin = route.duration / 60;
              document.getElementById('distance').textContent = distanceKm.toFixed(2);
              document.getElementById('duration').textContent = durationMin.toFixed(1);
            } else {
              alert("Routing failed: " + data.code);
            }
          });
      }
    });
  </script>
</body>
</html>