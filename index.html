<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Driving Route Finder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
  <style>
    #map { width: 100%; height: 500px; }
    #controls { margin: 10px 0; font-family: Arial, sans-serif; }
    select, input { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h2>Enter Locations to Get Driving Route</h2>
  <div id="controls">
    <input type="text" id="origin" placeholder="Origin (e.g., Springfield)">
    <button onclick="searchPlace('origin')">Search Origin</button>
    <select id="origin-options"></select><br>

    <input type="text" id="destination" placeholder="Destination (e.g., Boston)">
    <button onclick="searchPlace('destination')">Search Destination</button>
    <select id="destination-options"></select><br>

    <button onclick="getRoute()">Get Route</button>
  </div>
  <div id="map"></div>
  <div id="info">
    <strong>Distance:</strong> <span id="distance">0</span> km<br>
    <strong>Estimated Time:</strong> <span id="duration">0</span> minutes
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
  <script>
    const map = new ol.Map({
      target: 'map',
      layers: [new ol.layer.Tile({ source: new ol.source.OSM() })],
      view: new ol.View({
        center: ol.proj.fromLonLat([-73.935242, 40.730610]), // Default center
        zoom: 6
      })
    });

    const vectorSource = new ol.source.Vector();
    const routeStyle = new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: '#ff0000', // Bright red
        width: 5          // Thicker line
      })
    });
    const vectorLayer = new ol.layer.Vector({
      source: vectorSource,
      style: routeStyle
    });
    map.addLayer(vectorLayer);

    async function searchPlace(type) {
      const query = document.getElementById(type).value;
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`;
      const res = await fetch(url);
      const data = await res.json();

      const select = document.getElementById(`${type}-options`);
      select.innerHTML = "";

      data.forEach((place) => {
        const option = document.createElement("option");
        option.value = `${place.lon},${place.lat}`;
        option.text = place.display_name;
        select.appendChild(option);
      });

      if (data.length === 0) {
        alert(`No matches found for ${type}`);
      }
    }

    async function getRoute() {
      vectorSource.clear();
      document.getElementById('distance').textContent = '0';
      document.getElementById('duration').textContent = '0';

      const originCoords = document.getElementById('origin-options').value;
      const destinationCoords = document.getElementById('destination-options').value;

      if (!originCoords || !destinationCoords) {
        alert("Please select both origin and destination from the dropdowns.");
        return;
      }

      const url = `https://router.project-osrm.org/route/v1/driving/${originCoords};${destinationCoords}?overview=full&geometries=geojson`;
      const res = await fetch(url);
      const data = await res.json();

      if (data.code === "Ok") {
        const route = data.routes[0];
        const line = new ol.geom.LineString(route.geometry.coordinates).transform('EPSG:4326', 'EPSG:3857');
        vectorSource.addFeature(new ol.Feature({ geometry: line }));

        const distanceKm = route.distance / 1000;
        const durationMin = route.duration / 60;
        document.getElementById('distance').textContent = distanceKm.toFixed(2);
        document.getElementById('duration').textContent = durationMin.toFixed(1);

        map.getView().fit(line.getExtent(), { padding: [50, 50, 50, 50] });
      } else {
        alert("Routing failed: " + data.code);
      }
    }
  </script>
</body>
</html>